<script type="text/javascript">
  $(document).ready(function() {
    url = $('div[target]').attr('target');
    $('div[target]').css('background-image', "url(" + url + ")");
    $('div[target]').css('margin-bottom', '-70px');
    $('.show-body').fadeIn(2000);
  });
</script>

<div class="show-body" style="display: none;">
  <div class="head" target="<%= @show.banner_url %>">
    <div class="overlay">
      <div class="content">
        <div class="ui container pos-inherit grid">
          <div class="show-title">
            <h1 style="font-weight: bold;">
              <%= @show.title %>
            </h1>
            <p>
              <div id="action_buttons">
                <%= like_button(@show) %>
                <% love_button(@show) %>
                <%= dislike_button(@show) %>
                <%= queue_button(@show) %>
              </div>
            </p>
            <%= show_tags(@show) %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <small>
      <span style="margin-right: 10px;"><%= show_type_badge(@show) %></span>
      <%= @show.description %>
    </small>
  </div>

  <div class="container padded">
    <div class="hf-section">
      <%= seasons_tabs(@show) %>
    </div>

    <div class="hf-section">
      <div class="row no-margin">
        <div class="container-fluid">
          <% @episodes.each do |episode_info| %>
            <% episode_info[:episodes].each do |episodes| %>
              <div class="columns hide" season="<%= episode_info[:season] %>">
                <% episodes.each_with_index do |episode| %>
                  <div class="column is-4" style="margin-top: 20px;">
                    <%= link_to(episode) do %>
                      <%= show_thumb(episode) %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(() => {
    $('div[season="1"]').removeClass('hide');
    $('a[data-season]').on('click', (e) => {
      e.preventDefault();
      const $target = $(e.target);
      const season = $target.attr('data-season');

      $('div[season]').addClass('hide');
      $('li').removeClass('is-active');

      $target.parent().addClass('is-active');
      $('div[season="' + season + '"]').removeClass('hide');
    });

    $('#queue').on('click', function(e) {
      $.ajax({
        method: 'post',
        url: '<%= show_queue_path(@show, format: :json) %>',
        success: function(result) {
          if (result.result == 'added') {
            $('#queue').addClass('is-success')  
              .children('.material-icons')
              .html('playlist_add_check');
          } else if (result.result == 'removed') {
            $('#queue').removeClass('is-success')
              .children('.material-icons')
              .html('playlist_add');
          }
        }
      });
    });

    const enableReactToShow = function() {
      $('button[reaction]').on('click', reactToShow);
    }
    const reactToShow = function(e) {
      console.log('clicked');
      const $target = $(this);
      const reactionType = $target.attr('reaction');

      $.ajax({
        method: 'post',
        url: '<%= show_react_path(@show, format: :json) %>',
        data: { reaction: reactionType },
        success: function(result) {
          loadPartial('action_buttons', '<%= show_action_buttons_path(@show) %>', enableReactToShow);
        },
      });
    };

    enableReactToShow();
  });
</script>
