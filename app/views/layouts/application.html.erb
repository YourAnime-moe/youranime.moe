<!DOCTYPE html>
<html>
<head>
  <title><%= app_title %></title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
  <meta name="theme-color" content="<%= app_colour %>" />
  <meta name="msapplication-navbutton-color" content="<%= app_colour %>" />
  <meta name="apple-mobile-web-app-status-bar-style" content="<%= app_colour %>" />
  <meta name="viewport" content="width=device-width, shrink-to-fit=no, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <link rel="stylesheet" type="text/css" href="https://vjs.zencdn.net/<%= videojs_version %>/video-js.css">  
</head>

<% if logged_in? %>
    <header>
        <%= render 'shared/header' %>
    </header>
<% end %>

<body>

                        <% unless @login %>
    <div id="wrapper">
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="<%= @body_class %>">
                <div class="row">
                    <div class="col-lg-12">
                        <!-- <a href="#menu-toggle" class="btn btn-default">Show/Hide menu</a> -->
                            <% unless @login %>
                                <% flash.each do |message_type, message| %>
                                    <div id="flash" class="alert alert-<%= message_type %>"><%= message %></div>
                                <% end %>
                            <% end %>
                        <% end %>
                        <div class="anime-body">
                          <%= yield %>
                        </div>
                        <% unless @login %>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#page-content-wrapper -->

    </div>
    <!-- Toggle script -->
    <script type="text/javascript">
        $('document').ready(function() {
          setTimeout(function() {
            $('#flash').slideUp();
          }, 3000);
        });
    </script>
                        <% end %>
    <script type="text/javascript">
          var watched_episodes = $('html').find('.watched');
          for (var i = 0; i < watched_episodes.length; i++) {
            console.log('Hwllo %s', i);
            watched_episodes[i].title = "You've already watched this episode.";
            var name = watched_episodes[i].children[0].attributes.name;

            if (!name) {
              return;
            }

            var id = name.textContent;
            
            videos = localStorage.getItem('videos');
            videos = JSON.parse(videos);
            for(var j = 0; j < videos.length; j++) {
                episode = videos[j];
                if (episode.videoId == id) {
                    if (episode.ratio !== undefined) {
                        var progressBar = $('div#progress_' + id);
                        ratioInfo = 'width: ' + parseInt(episode.ratio) + '%;';
                        progressBar.attr('style', ratioInfo);
                        progressBar.removeClass('hidden');
                    }
                }
            }
          }
    </script>
<!-- /#wrapper -->

    <!-- <script type="text/javascript" src="/js/tp/videojs-playlist/dist/videojs-playlist.js"></script> -->
    <!-- <script type="text/javascript" src="/js/videojs-playlist.js"></script> -->
</body>

<% if logged_in? %>
  <footer>
     <%= render 'shared/footer' %>
  </footer>
<% end %>
</html>
